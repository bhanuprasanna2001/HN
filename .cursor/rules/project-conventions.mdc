---
alwaysApply: true
---

# TrustOps OS — Project Conventions

## Project Identity
- Project name: **TrustOps OS**
- Tagline: "Provenance-first, policy-governed, self-learning support layer"
- This is a hackathon project for RealPage's "Self-Learning AI System for Support" challenge

## Repository Structure (Monorepo)
```
HN/
├── backend/                  # Python FastAPI service
│   ├── app/
│   │   ├── main.py           # FastAPI entrypoint
│   │   ├── api/              # Route modules (/runs, /learn, /approve, /metrics)
│   │   ├── agents/           # LangGraph nodes (triage, retrieval, guard, answer, learn, publish)
│   │   ├── core/             # Config, settings, constants, dependencies
│   │   ├── models/           # Pydantic schemas (request/response)
│   │   ├── services/         # Business logic (redis, embedding, drift, qa)
│   │   ├── policies/         # Policy-as-code guardrail definitions
│   │   └── telemetry/        # OTel instrumentation setup
│   ├── tests/
│   ├── pyproject.toml
│   └── Dockerfile
├── frontend/                 # React SPA (Vite + TypeScript)
│   ├── src/
│   │   ├── components/       # Reusable UI components
│   │   ├── pages/            # Page-level views (Ask, Evidence, Learning, Dashboard)
│   │   ├── hooks/            # Custom React hooks (useRunStream, useEventSource, etc.)
│   │   ├── services/         # API client + SSE EventSource manager
│   │   ├── stores/           # State management (Zustand)
│   │   ├── types/            # TypeScript type definitions
│   │   └── utils/            # Shared utilities
│   ├── package.json
│   ├── vite.config.ts
│   └── Dockerfile
├── data/                     # Dataset files
│   └── SupportMind__Final_Data.xlsx
├── pipelines/                # PySpark batch processing scripts
│   ├── ingest.py             # Excel → structured corpora
│   ├── embed.py              # Generate embeddings + Redis load
│   └── analytics.py          # Root cause mining / clustering
├── infra/                    # Deployment manifests
│   ├── docker-compose.yml    # Local full-stack orchestration
│   ├── docker-compose.dev.yml
│   ├── otel-collector-config.yaml
│   ├── prometheus.yml
│   ├── grafana/
│   │   └── dashboards/       # Pre-built JSON dashboards
│   └── k8s/                  # Minimal Kubernetes manifests
├── docs/                     # Architecture diagrams, ADRs
└── scripts/                  # Dev helper scripts (seed, test, demo)
```

## Naming Conventions
- **Python**: snake_case for variables/functions/modules, PascalCase for classes
- **TypeScript/React**: camelCase for variables/functions, PascalCase for components/types
- **Files**: snake_case for Python, kebab-case for TypeScript/React
- **API endpoints**: lowercase kebab-case paths (`/api/v1/learning-events`)
- **Environment variables**: UPPER_SNAKE_CASE, prefixed by service (`TRUSTOPS_REDIS_URL`, `TRUSTOPS_LLM_MODEL`)
- **Docker images**: `trustops-{service}` (e.g., `trustops-backend`, `trustops-frontend`)
- **Git branches**: `phase/{n}/description` (e.g., `phase/1/data-retrieval-spine`)

## Code Quality Rules
- All Python code must have type hints
- All API endpoints must have Pydantic request/response models
- All LangGraph nodes must log their inputs/outputs via OTel spans
- Never hardcode secrets — use environment variables or `.env` files (never commit `.env`)
- Every function that touches LLM output must validate/sanitize before returning
- Prefer explicit error handling over silent failures
- All async endpoints in FastAPI — no blocking calls on the main event loop

## Documentation
- Each module must have a one-line docstring explaining its purpose
- API endpoints documented via FastAPI's built-in OpenAPI (auto-generated)
- Architecture decisions logged in `docs/` only when explicitly requested

## Data Handling
- The dataset lives at `data/SupportMind__Final_Data.xlsx` — NEVER modify the original
- Processed/derived data goes to `data/processed/` (gitignored)
- Never log or expose real PII — the dataset is synthetic but treat it as if it were real
- Never use `data/speare-docs/` — this is explicitly excluded

## Testing Strategy
- Unit tests for policy checks, schema validation, utility functions
- Integration tests for LangGraph workflow end-to-end
- Retrieval accuracy tests using Questions tab ground truth (hit@k)
- Use pytest for backend, vitest for frontend

## Git Workflow
- Commit messages: `phase(N): concise description` (e.g., `phase(1): add redis vector store service`)
- One logical change per commit
- Never commit generated files, .env, or large binary outputs
